<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=no" />
		<title>Idle Goblin War</title>
		<style type="text/css">
			* {
				font-size: 16px;
			}
		</style>
	</head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<body onload="setup()">
		<p id="info"></p>
		<p id="action"></p>
		<script>
			var health = 1;
			var maxHealth = 1;
			var damage = 1;
			var experience = 0;
			var level = 1;
			
			//Test
			var maxGoblinLevel = 0;
			var turns = 0;
			
			var creatureNames = [
				"Goblin Egg", 
				"Goblin Larva", 
				"Feral Goblin Toddler", 
				"Vicious Goblin Child", 
				"Cruel Adolescent Goblin",
				"Young Goblin Soldier",
				"Goblin Warrior"];
			
			function creature(name)
			{
				this.name = name;
				if (name == creatureNames[0])
				{
					this.health = 5;
					this.damage = 0;
					this.experience = 1;
				}
				else if (name == creatureNames[1])
				{
					this.health = 5;
					this.damage = 1;
					this.experience = 2;
				}
				else if (name == creatureNames[2])
				{
					this.health = 15;
					this.damage = 3;
					this.experience = 3;
				}
				else if (name == creatureNames[3])
				{
					this.health = 20;
					this.damage = 5;
					this.experience = 4;
				}
				else if (name == creatureNames[4])
				{
					this.health = 20;
					this.damage = 10;
					this.experience = 5;
				}
				else if (name == creatureNames[5])
				{
					this.health = 45;
					this.damage = 15;
					this.experience = 5;
				}
				else if (name == creatureNames[6])
				{
					this.health = 50;
					this.damage = 25;
					this.experience = 6;
				}
			}
			
			var target = new creature(creatureNames[0]);
			
			function levelUp()
			{
				var rand = Math.random();
				if (rand < 0.5)
				{
					damage++;
				}
				else
				{
					maxHealth++;
				}
			}
			
			function selectTarget()
			{
				var selectedTarget = new creature(creatureNames[0]);
				for (let i = 0; i < creatureNames.length; i++)
				{
					var potentialTarget = new creature(creatureNames[i]);
					if (potentialTarget.damage < maxHealth / 2)
					{
						selectedTarget = potentialTarget;
						if (i > maxGoblinLevel)
						{
							maxGoblinLevel = i;
							console.log("Fought " + potentialTarget.name + " at level " + level + " on turn " + turns + ".");
						}
					}
					else
					{
						i = creatureNames.length
					}
				}
				return selectedTarget;
			}
			
			function setup()
			{
				update();
				setInterval(update, 1000)
			}
			function update()
			{
				turns++;
				var actionString = "";
				if (health > target.damage)
				{
					actionString += "You attack " + target.name + " for " + damage + " damage.";
					target.health -= damage;
					if (target.health <= 0)
					{
						actionString += " " + target.name + " is dead. You gain " + target.experience + " experience."
						experience += target.experience;
						if (experience >= level * 10)
						{
							experience = 0;
							level++;
							actionString+= " Your level increases!";
							levelUp();
						}
						
						target = selectTarget();
						actionString += " " + target.name + " wants to fight."
					}
					else
					{
						actionString += " " + target.name + " has " + target.health + " health remaining. " + target.name + " attacks you for " + target.damage + " damage."
						health -= target.damage;
					}
				}
				else
				{
					actionString += "You rest to restore your health.";
					health = maxHealth;
				}
				
				$('#action').html(actionString);
				
				var infoString = "Health: " + health + "<br/>Damage: " + damage + "<br/>Level: " + level + "<br/>Experience: " + experience;
				
				$('#info').html(infoString);
			}
		</script>
	</body>
</html>
